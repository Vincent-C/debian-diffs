From f81e0823c5bbf7692b20819328a2dd78bfa196b8 Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Sat, 22 Nov 2014 12:44:33 +0100
Subject: [type42] Allow only embedded TrueType fonts. CVE-2014-9661

This is a follow-up to Savannah bug #43659.

* src/type42/t42objs.c (T42_Face_Init): Exclusively use the
`truetype' font driver for loading the font contained in the `sfnts'
array.

(cherry picked from commit 42fcd6693ec7bd6ffc65ddc63e74287a65dda669)
---
 freetype-2.5.2/src/type42/t42objs.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git freetype-2.5.2/src/type42/t42objs.c freetype-2.5.2/src/type42/t42objs.c
index f5aa2ca..af64bf7 100644
--- freetype-2.5.2/src/type42/t42objs.c
+++ freetype-2.5.2/src/type42/t42objs.c
@@ -286,7 +286,9 @@
       FT_Open_Args  args;
 
 
-      args.flags       = FT_OPEN_MEMORY;
+      args.flags       = FT_OPEN_MEMORY | FT_OPEN_DRIVER;
+      args.driver      = FT_Get_Module( FT_FACE_LIBRARY( face ),
+                                        "truetype" );
       args.memory_base = face->ttf_data;
       args.memory_size = face->ttf_size;
 
-- 
2.1.4

