From 4ebd46e114fb98084d937d09e003c9fd8f6f5939 Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Wed, 12 Nov 2014 21:42:13 +0100
Subject: [sfnt] Fix Savannah bug #43591. CVE-2014-9666

* src/sfnt/ttsbit.c (tt_sbit_decoder_init): Protect against addition
and multiplication overflow.

(cherry picked from commit 257c270bd25e15890190a28a1456e7623bba4439)
---
 freetype-2.5.2/src/sfnt/ttsbit.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git freetype-2.5.2/src/sfnt/ttsbit.c freetype-2.5.2/src/sfnt/ttsbit.c
index 38c680e..f223c5a 100644
--- freetype-2.5.2/src/sfnt/ttsbit.c
+++ freetype-2.5.2/src/sfnt/ttsbit.c
@@ -380,9 +380,11 @@
       p                          += 34;
       decoder->bit_depth          = *p;
 
-      if ( decoder->strike_index_array > face->sbit_table_size             ||
-           decoder->strike_index_array + 8 * decoder->strike_index_count >
-             face->sbit_table_size                                         )
+      /* decoder->strike_index_array +                               */
+      /*   8 * decoder->strike_index_count > face->sbit_table_size ? */
+      if ( decoder->strike_index_array > face->sbit_table_size           ||
+           decoder->strike_index_count >
+             ( face->sbit_table_size - decoder->strike_index_array ) / 8 )
         error = FT_THROW( Invalid_File_Format );
     }
 
-- 
2.1.4

