From eae341fbe8a57e4d30050b71f2956f1da053eb4b Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Wed, 12 Nov 2014 21:06:08 +0100
Subject: [sfnt] Fix Savannah bug #43589. CVE-2014-9668

* src/sfnt/sfobjs.c (woff_open_font): Protect against addition
overflow.

(cherry picked from commit f46add13895337ece929b18bb8f036431b3fb538)
---
 freetype-2.5.2/src/sfnt/sfobjs.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git freetype-2.5.2/src/sfnt/sfobjs.c freetype-2.5.2/src/sfnt/sfobjs.c
index a31c77c..d202ca0 100644
--- freetype-2.5.2/src/sfnt/sfobjs.c
+++ freetype-2.5.2/src/sfnt/sfobjs.c
@@ -574,8 +574,10 @@
 
 
       if ( table->Offset != woff_offset                         ||
-           table->Offset + table->CompLength > woff.length      ||
-           sfnt_offset + table->OrigLength > woff.totalSfntSize ||
+           table->CompLength > woff.length                      ||
+           table->Offset > woff.length - table->CompLength      ||
+           table->OrigLength > woff.totalSfntSize               ||
+           sfnt_offset > woff.totalSfntSize - table->OrigLength ||
            table->CompLength > table->OrigLength                )
       {
         error = FT_THROW( Invalid_Table );
-- 
2.1.4

