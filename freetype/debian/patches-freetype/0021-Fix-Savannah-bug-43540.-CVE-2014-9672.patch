From fd240e4f474a3d1006b3467fb9a891d94770fdf4 Mon Sep 17 00:00:00 2001
From: suzuki toshiya <mpsuzuki@hiroshima-u.ac.jp>
Date: Wed, 26 Nov 2014 16:11:38 +0900
Subject: Fix Savannah bug #43540. CVE-2014-9672

* src/base/ftmac.c (parse_fond): Prevent a buffer overrun
caused by a font including too many (> 63) strings to store
names[] table.

(cherry picked from commit 18a8f0d9943369449bc4de92d411c78fb08d616c)
---
 freetype-2.5.2/src/base/ftmac.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git freetype-2.5.2/src/base/ftmac.c freetype-2.5.2/src/base/ftmac.c
index 9b49da8..184a2e1 100644
--- freetype-2.5.2/src/base/ftmac.c
+++ freetype-2.5.2/src/base/ftmac.c
@@ -440,9 +440,10 @@
       style = (StyleTable*)p;
       p += sizeof ( StyleTable );
       string_count = EndianS16_BtoN( *(short*)(p) );
+      string_count = FT_MIN( 64, string_count );
       p += sizeof ( short );
 
-      for ( i = 0; i < string_count && i < 64; i++ )
+      for ( i = 0; i < string_count; i++ )
       {
         names[i] = p;
         p       += names[i][0];
@@ -459,7 +460,7 @@
           ps_name[ps_name_len] = 0;
         }
         if ( style->indexes[face_index] > 1 &&
-             style->indexes[face_index] <= FT_MIN( string_count, 64 ) )
+             style->indexes[face_index] <= string_count )
         {
           unsigned char*  suffixes = names[style->indexes[face_index] - 1];
 
-- 
2.1.4

