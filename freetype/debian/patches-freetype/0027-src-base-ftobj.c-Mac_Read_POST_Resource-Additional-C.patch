From 227701e7a216e77f97fc170702d70f9c1a84992a Mon Sep 17 00:00:00 2001
From: suzuki toshiya <mpsuzuki@hiroshima-u.ac.jp>
Date: Thu, 27 Nov 2014 00:20:48 +0900
Subject: =?UTF-8?q?*=20src/base/ftobj.c=20(Mac=5FRead=5FPOST=5FResource):?=
 =?UTF-8?q?=20Additional=20CVE-2014-0674-part-2=0Aoverflow=20check=20in=20?=
 =?UTF-8?q?the=20summation=20of=20POST=20fragment=20lengths,=0Asuggested?=
 =?UTF-8?q?=20by=20Mateusz=20Jurczyk=20<mjurczyk@google.com>.?=

(cherry picked from commit cd4a5a26e591d01494567df9dec7f72d59551f6e)
---
 freetype-2.5.2/src/base/ftobjs.c | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git freetype-2.5.2/src/base/ftobjs.c freetype-2.5.2/src/base/ftobjs.c
index 4a9eb7f..038a0f8 100644
--- freetype-2.5.2/src/base/ftobjs.c
+++ freetype-2.5.2/src/base/ftobjs.c
@@ -1609,8 +1609,10 @@
        */
       FT_TRACE4(( "                 POST fragment #%d: length=0x%08x\n",
                   i, temp));
-      if ( 0x7FFFFFFFUL < temp )
+      if ( 0x7FFFFFFFUL < temp || pfb_len + temp + 6 < pfb_len )
       {
+        FT_TRACE2(( "             too long fragment length makes"
+                    " pfb_len confused: temp=0x%08x\n", temp ));
         error = FT_THROW( Invalid_Offset );
         goto Exit;
       }
@@ -1623,8 +1625,7 @@
                  resource_cnt, pfb_len + 2));
     if ( pfb_len + 2 < 6 ) {
       FT_TRACE2(( "             too long fragment length makes"
-                  " pfb_len confused: 0x%08x\n",
-                  pfb_len ));
+                  " pfb_len confused: pfb_len=0x%08x\n", pfb_len ));
       error = FT_THROW( Array_Too_Large );
       goto Exit;
     }
-- 
2.1.4

